<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Appointment | Binamira Medical Clinic</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #d62828;
            --primary-dark: #a51c1c;
            --secondary: #003049;
            --accent: #f77f00;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark);
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 150px;
            padding: 0 40px;
            background-color: #b30000;
            position: relative;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.03) 0%, transparent 100%);
            z-index: -1;
            transform: translateY(-100%);
            transition: transform 1.2s cubic-bezier(0.16, 1, 0.3, 1);
        }

        header:hover {
            transform: translateY(-2px);
        }

        header:hover::before {
            transform: translateY(0);
        }

        /* Logo with 3D tilt effect */
        .logo {
            display: flex;
            align-items: center;
            height: 100%;
            perspective: 1000px;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .logo:hover {
            transform: rotateY(5deg) scale(1.03);
        }

        .logo img {
            height: 350px;
            width: auto;
            object-fit: contain;
            display: block;
            filter: drop-shadow(0 2px 10px rgba(0, 0, 0, 0.15));
            transition: 
                filter 0.5s ease,
                transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: center bottom;
        }

        .logo:hover img {
            filter: drop-shadow(0 4px 20px rgba(0, 0, 0, 0.2));
            transform: scale(1.05) rotateZ(0.5deg);
        }

        /* Navigation with dynamic underline */
        nav ul {
            list-style: none;
            display: flex;
            gap: 25px;
            align-items: center;
            margin: 0;
            padding: 0;
        }

        nav a {
            text-decoration: none;
            color: white;
            font-weight: 600;
            position: relative;
            padding: 10px 0;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
            transition: color 0.4s ease-out;
        }

        nav li:not(.booking-button-container) a::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            bottom: 0;
            left: 0;
            background: white;
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.6s cubic-bezier(0.65, 0, 0.35, 1);
        }

        nav li:not(.booking-button-container) a::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            bottom: -3px;
            left: 0;
            background: white;
            border-radius: 50%;
            transform: translateX(-100%) scale(0);
            transition: 
                transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                left 0.6s cubic-bezier(0.65, 0, 0.35, 1);
        }

        nav li:not(.booking-button-container) a:hover {
            color: #ffebee;
        }

        nav li:not(.booking-button-container) a:hover::before {
            transform: scaleX(1);
            transform-origin: left;
        }

        nav li:not(.booking-button-container) a:hover::after {
            transform: translateX(0) scale(1);
            left: 100%;
        }

        /* Employee Access button with glossy effect */
        .login-link {
            padding: 8px 16px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1;
        }

        .login-link::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255,255,255,0.3) 0%,
                rgba(255,255,255,0) 60%
            );
            transform: rotate(30deg) translate(-20%, -20%);
            transition: transform 0.8s ease;
            z-index: -1;
        }

        .login-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 0.15);
        }

        .login-link:hover::before {
            transform: rotate(30deg) translate(20%, 20%);
        }

        /* Book Now button with liquid fill */
        .booking-button {
            background-color: transparent;
            color: white;
            padding: 12px 28px;
            border-radius: 30px;
            font-weight: 600;
            border: 2px solid white;
            position: relative;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1;
        }

        .booking-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: -1;
            transform: scaleY(0);
            transform-origin: bottom;
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 30px;
        }

        .booking-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255,255,255,0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.6s ease;
        }

        .booking-button:hover {
            color: #b30000;
            border-color: transparent;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .booking-button:hover::before {
            transform: scaleY(1);
        }

        .booking-button:hover::after {
            transform: translate(-50%, -50%) scale(20);
            opacity: 0;
            transition: 
                transform 1s ease,
                opacity 0.6s ease;
        }

        /* Main container */
        .main-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Form Header */
        .form-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .form-header h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 28px;
        }

        .form-header p {
            color: var(--gray);
            font-size: 16px;
        }

        /* Booking Form */
        .booking-form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            padding: 30px;
            margin: 0 auto;
            max-width: 900px;
        }

        .medical-booking-form {
            display: flex;
            flex-direction: column;
        }

        .form-section {
            margin-bottom: 25px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        .form-section h3 {
            color: var(--secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 18px;
        }

        .form-section h3 i {
            margin-right: 10px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary);
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(214, 40, 40, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .consent-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .consent-container input {
            width: auto;
            margin-right: 10px;
        }

        .consent-container label {
            margin-bottom: 0;
            font-weight: 400;
            font-size: 13px;
        }

        .consent-container a {
            color: var(--primary);
            text-decoration: none;
        }

        .submit-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .submit-btn i {
            margin-right: 10px;
        }

        .submit-btn:hover {
            background-color: var(--primary-dark);
        }

        .form-note {
            text-align: center;
            margin-top: 15px;
            font-size: 13px;
            color: var(--gray);
        }

        /* Calendar and Time Slot Styling */
        .availability-container {
            margin-top: 20px;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 20px;
            background-color: white;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            background: var(--light-gray);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-nav button:hover {
            background: var(--primary);
            color: white;
        }

        .calendar-title {
            font-weight: 600;
            color: var(--secondary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 12px;
            color: var(--gray);
            font-weight: 500;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
        }

        .calendar-day.available:hover {
            background: var(--primary);
            color: white;
        }

        .calendar-day.available {
            background: rgba(214, 40, 40, 0.1);
            color: var(--primary);
            font-weight: 500;
        }

        .calendar-day.unavailable {
            color: var(--light-gray);
            cursor: not-allowed;
        }

        .calendar-day.today {
            border: 1px solid var(--primary);
        }

        .calendar-day.selected {
            background: var(--primary);
            color: white;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .time-slot {
            padding: 10px;
            text-align: center;
            background: rgba(214, 40, 40, 0.1);
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .time-slot:hover {
            background: var(--primary);
            color: white;
        }

        .time-slot.selected {
            background: var(--primary);
            color: white;
        }

        .time-slot.booked {
            background: var(--light-gray);
            color: var(--gray);
            cursor: not-allowed;
            text-decoration: line-through;
        }

        .confirmation-message {
            display: none;
            background: rgba(214, 40, 40, 0.1);
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .confirmation-message h4 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .confirmation-message h4 i {
            margin-right: 10px;
        }

        .confirmation-message p {
            font-size: 14px;
            color: var(--secondary);
        }

        .emergency-contact {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary);
            color: white;
            border-radius: 8px;
            font-size: 14px;
        }

        .emergency-contact i {
            margin-right: 10px;
            color: var(--accent);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                height: auto;
                padding: 20px;
            }
            
            .logo {
                margin-bottom: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .time-slots {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .booking-form-container {
                padding: 20px;
            }
            
            .form-section {
                padding: 15px;
            }
        }

        @media (max-width: 576px) {
            nav ul {
                width: 100%;
                justify-content: space-around;
            }
            
            nav ul li {
                margin: 5px;
            }
            
            .booking-button {
                padding: 8px 15px;
                font-size: 14px;
            }
            
            .time-slots {
                grid-template-columns: 1fr;
            }
            
            .form-header h1 {
                font-size: 24px;
            }
        }
    
    </style>
</head>
<body>
  <header>
    <div class="logo">
        <img src="images/logo3.svg" alt="Binamira Medical Clinic Logo">
    </div>
    <nav>
    <ul>
      <li><a href="index.html">HOME</a></li>
      <li><a href="about.html">ABOUT</a></li>
      <li><a href="services.html">SERVICES</a></li>
      <li><a href="contactus.html">CONTACT</a></li>
      <li><a href="employee_access.php" class="login-link">EMPLOYEE ACCESS</a></li>
      <li class="booking-button-container">
        <a href="booking.html" class="booking-button">BOOK NOW</a>
      </li>
    </ul>
  </nav>
</header>

<div class="main-container">
    <div class="booking-form-container">
        <div class="form-header">
            <h1>Schedule Your Appointment</h1>
            <p>Complete this form to book your consultation with our medical specialists</p>
        </div>

              <form id="appointmentForm" class="medical-booking-form">
            <div class="form-section personal-info">
                <h3><i class="fas fa-user"></i> Personal Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" name="name" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="birthdate">Date of Birth</label>
                        <input type="date" id="birthdate" name="birthdate" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" id="age" name="age" placeholder="Enter your age" min="0" max="120" required>
                    </div>
                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <select id="gender" name="gender" required>
                            <option value="" disabled selected>Select gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" name="email" placeholder="example@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="mobile">Mobile Number</label>
                        <input type="tel" id="mobile" name="mobile" placeholder="+63 908 876 2024" required>
                    </div>
                </div>
            </div>
             
            <div class="form-section appointment-details">
                <h3><i class="fas fa-calendar-check"></i> Appointment Details</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="clinic">Preferred Clinic Branch</label>
                        <select id="clinic" name="clinic" required>
                            <option value="" disabled selected>Select a branch</option>
                            <option value="bacacay">Bacacay Main Clinic</option>
                            <option value="legazpi">Legazpi City Branch</option>
                            <option value="tabaco">Tabaco Satellite Clinic</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="service">Service Type</label>
                        <select id="service" name="service" required>
                            <option value="" disabled selected>Select service</option>
                            <option value="general">General Check-up</option>
                            <option value="diagnostic">Diagnostic Test</option>
                            <option value="Family Medicine">Family Medicine</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="doctor">Preferred Doctor</label>
                    <select id="doctor" name="doctor" required>
                        <option value="" selected>Loading doctors...</option>
                    </select>
                </div>
            
            <div class="availability-container">
                <div class="calendar-header">
                    <div class="calendar-title">May 2023</div>
                    <div class="calendar-nav">
                        <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                        <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                  <div class="calendar-grid">
                        <div class="calendar-day-header">Sun</div>
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                        
                        <div class="calendar-day available">29</div>
                        <div class="calendar-day available">30</div>
                        <div class="calendar-day available">1</div>
                        <div class="calendar-day available">2</div>
                        <div class="calendar-day available">3</div>
                        <div class="calendar-day available">4</div>
                        <div class="calendar-day unavailable">5</div>
                        <div class="calendar-day unavailable">6</div>
                        <div class="calendar-day available">7</div>
                        <div class="calendar-day available">8</div>
                        <div class="calendar-day available today">9</div>
                        <div class="calendar-day available">10</div>
                        <div class="calendar-day available">11</div>
                        <div class="calendar-day available">12</div>
                        <div class="calendar-day available">13</div>
                        <div class="calendar-day available">14</div>
                        <div class="calendar-day available">15</div>
                        <div class="calendar-day available">16</div>
                        <div class="calendar-day available">17</div>
                        <div class="calendar-day available">18</div>
                        <div class="calendar-day available">19</div>
                        <div class="calendar-day available">20</div>
                        <div class="calendar-day available">21</div>
                        <div class="calendar-day available">22</div>
                        <div class="calendar-day available">23</div>
                        <div class="calendar-day available">24</div>
                        <div class="calendar-day available">25</div>
                        <div class="calendar-day available">26</div>
                        <div class="calendar-day available">27</div>
                        <div class="calendar-day available">28</div>
                        <div class="calendar-day available">29</div>
                        <div class="calendar-day available">30</div>
                        <div class="calendar-day available">31</div>
                        <div class="calendar-day unavailable">1</div>
                        <div class="calendar-day unavailable">2</div>
                    </div>
                
                <label>Available Time Slots</label>
                <div class="time-slots">
                    <!-- Updated time slots with data attributes -->
                    <div class="time-slot" data-time="09:00:00">9:00 AM</div>
                    <div class="time-slot" data-time="09:30:00">9:30 AM</div>
                    <div class="time-slot booked" data-time="10:00:00">10:00 AM</div>
                    <div class="time-slot" data-time="10:30:00">10:30 AM</div>
                    <div class="time-slot" data-time="11:00:00">11:00 AM</div>
                    <div class="time-slot booked" data-time="11:30:00">11:30 AM</div>
                    <div class="time-slot" data-time="13:00:00">1:00 PM</div>
                    <div class="time-slot" data-time="13:30:00">1:30 PM</div>
                    <div class="time-slot" data-time="14:00:00">2:00 PM</div>
                    <div class="time-slot" data-time="14:30:00">2:30 PM</div>
                    <div class="time-slot" data-time="15:00:00">3:00 PM</div>
                    <div class="time-slot" data-time="15:30:00">3:30 PM</div>
                </div>
            </div>
            
            <div class="form-group">
                    <label for="reason">Reason for Visit</label>
                    <textarea id="reason" name="reason" rows="3" placeholder="Briefly describe your symptoms or reason for appointment" required></textarea>
                </div>
            </div>

            <div class="confirmation-message" id="confirmationMessage">
                <h4><i class="fas fa-check-circle"></i> Appointment Confirmed!</h4>
                <p>Your appointment has been scheduled for <strong id="confirmedDate">May 15, 2023 at 10:30 AM</strong>.</p>
                <p>A confirmation has been sent to your email address.</p>
            </div>

            <div class="form-footer">
                <div class="consent-container">
                    <input type="checkbox" id="consent" name="consent" required>
                    <label for="consent">
                        I agree to the <a href="#" target="_blank">Privacy Policy</a> and consent to the processing of my personal data.
                    </label>
                </div>
                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i> Confirm Appointment
                </button>
                <p class="form-note">You will receive a confirmation email and SMS with your appointment details.</p>
            </div>
        </form>
        </form>
        
        <div class="emergency-contact">
            <i class="fas fa-phone-alt"></i>
            <span>Emergency: 0917 123 4567</span>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const doctorSelect = document.getElementById('doctor');
    const calendarTitle = document.querySelector('.calendar-title');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');
    const calendarGrid = document.querySelector('.calendar-grid');
    const timeSlotsContainer = document.querySelector('.time-slots');
    
    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;
    let bookedAppointments = {};

    function isTimeSlotAvailable(dateStr, timeStr) {
        if (!bookedAppointments[dateStr]) return true;
        return !bookedAppointments[dateStr].includes(timeStr);
    }

    // Initialize calendar and doctors
    fetchBookedAppointments().then(() => {
        initCalendar();
        fetchDoctors();
    });

    // Fetch all booked appointments from the database
    async function fetchBookedAppointments() {
        try {
            const response = await fetch('get_booked_appointments.php');
            const data = await response.json();
            
            if (data.success) {
                bookedAppointments = data.appointments.reduce((acc, appointment) => {
                    const dateStr = appointment.date;
                    if (!acc[dateStr]) {
                        acc[dateStr] = [];
                    }
                    acc[dateStr].push(appointment.time);
                    return acc;
                }, {});
            } else {
                console.error('Error loading appointments:', data.message);
            }
        } catch (error) {
            console.error('Error fetching appointments:', error);
        }
    }

    function initCalendar() {
        renderCalendar(currentDate);
    }

    function renderCalendar(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        
        calendarTitle.textContent = `${getMonthName(month)} ${year}`;
        
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const prevMonthDays = new Date(year, month, 0).getDate();
        
        // Clear existing calendar days (keep headers)
        const dayElements = document.querySelectorAll('.calendar-day');
        dayElements.forEach(day => day.remove());
        
        // Add days from previous month
        for (let i = firstDay - 1; i >= 0; i--) {
            const day = document.createElement('div');
            day.className = 'calendar-day unavailable';
            day.textContent = prevMonthDays - i;
            calendarGrid.appendChild(day);
        }
        
        // Add days for current month
        for (let i = 1; i <= daysInMonth; i++) {
            const day = document.createElement('div');
            const dayDate = new Date(year, month, i);
            const dateStr = formatDateForMySQL(dayDate);
            
            // Check if day is fully booked or in the past
            const isFullyBooked = checkIfDateFullyBooked(dateStr);
            const isPastDate = dayDate < new Date(new Date().setHours(0,0,0,0));
            
            day.className = isFullyBooked || isPastDate ? 'calendar-day unavailable' : 'calendar-day available';
            day.textContent = i;
            day.dataset.day = i;
            day.dataset.month = month + 1;
            day.dataset.year = year;
            day.dataset.date = dateStr;
            
            // Highlight today
            const today = new Date();
            if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                day.classList.add('today');
            }
            
            calendarGrid.appendChild(day);
        }
        
        // Add days from next month to fill grid
        const totalCells = firstDay + daysInMonth;
        const nextMonthDays = 42 - totalCells;
        for (let i = 1; i <= nextMonthDays; i++) {
            const day = document.createElement('div');
            day.className = 'calendar-day unavailable';
            day.textContent = i;
            calendarGrid.appendChild(day);
        }
        
        // Add click handlers for available days
        document.querySelectorAll('.calendar-day.available').forEach(day => {
            day.addEventListener('click', function() {
                document.querySelectorAll('.calendar-day.selected').forEach(el => el.classList.remove('selected'));
                this.classList.add('selected');
                updateTimeSlots(this.dataset.date);
            });
        });
    }

    function checkIfDateFullyBooked(dateStr) {
        if (!bookedAppointments[dateStr]) return false;
        
        const allTimeSlots = [
            '09:00:00', '09:30:00', '10:00:00', '10:30:00',
            '11:00:00', '11:30:00', '13:00:00', '13:30:00',
            '14:00:00', '14:30:00', '15:00:00', '15:30:00'
        ];
        
        return allTimeSlots.every(slot => bookedAppointments[dateStr].includes(slot));
    }

    function updateTimeSlots(selectedDateStr) {
        if (!selectedDateStr) return;
        
        timeSlotsContainer.innerHTML = '';
        
        const allTimeSlots = [
            '09:00:00', '09:30:00', '10:00:00', '10:30:00',
            '11:00:00', '11:30:00', '13:00:00', '13:30:00',
            '14:00:00', '14:30:00', '15:00:00', '15:30:00'
        ];
        
        const bookedSlots = bookedAppointments[selectedDateStr] || [];
        
        allTimeSlots.forEach(slot => {
            const isAvailable = isTimeSlotAvailable(selectedDateStr, slot);
            const timeSlot = document.createElement('div');
            timeSlot.className = isAvailable ? 'time-slot' : 'time-slot booked';
            timeSlot.textContent = formatTimeForDisplay(slot);
            timeSlot.dataset.time = slot;
            
            if (isAvailable) {
                timeSlot.addEventListener('click', function() {
                    document.querySelectorAll('.time-slot.selected').forEach(el => el.classList.remove('selected'));
                    this.classList.add('selected');
                });
            }
            
            timeSlotsContainer.appendChild(timeSlot);
        });
    }


    // Month navigation
    prevMonthBtn.addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });

    nextMonthBtn.addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });

    // Fetch doctors
    function fetchDoctors() {
        fetch('get_doctors.php')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.doctors?.length) {
                    doctorSelect.innerHTML = '<option value="" disabled selected>Select a doctor</option>';
                    data.doctors.forEach(doctor => {
                        const option = document.createElement('option');
                        option.value = doctor.id;
                        option.textContent = `Dr. ${doctor.name}`;
                        doctorSelect.appendChild(option);
                    });
                } else {
                    throw new Error(data.message || 'No doctors available');
                }
            })
            .catch(error => {
                console.error('Error loading doctors:', error);
                doctorSelect.innerHTML = '<option value="" disabled>Error loading doctors</option>';
            });
    }

    // Age calculation
    document.getElementById('birthdate').addEventListener('change', function() {
        const birthDate = new Date(this.value);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) age--;
        document.getElementById('age').value = age;
    });

    // Form submission
    document.getElementById('appointmentForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const selectedDayElement = document.querySelector('.calendar-day.selected');
        const selectedTimeElement = document.querySelector('.time-slot.selected');
        
        if (!selectedDayElement || !selectedTimeElement) {
            alert('Please select both date and time for your appointment.');
            document.querySelector('.availability-container').scrollIntoView({ behavior: 'smooth' });
            return;
        }
        
        const selectedDate = new Date(
            parseInt(selectedDayElement.dataset.year),
            parseInt(selectedDayElement.dataset.month) - 1,
            parseInt(selectedDayElement.dataset.day)
        );
        const selectedTime = selectedTimeElement.dataset.time;
        
        try {
            const formData = new FormData(this);
            const formattedDate = formatDateForMySQL(selectedDate);
            
            formData.append('appointmentDate', formattedDate);
            formData.append('appointmentTime', selectedTime);
            
            const response = await fetch('save_appointment.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams(formData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Update local bookings
                if (!bookedAppointments[formattedDate]) bookedAppointments[formattedDate] = [];
                bookedAppointments[formattedDate].push(selectedTime);
                
                // Show confirmation
                document.getElementById('confirmationMessage').style.display = 'block';
                document.getElementById('confirmedDate').textContent = 
                    `${formatDateForDisplay(formattedDate)} at ${formatTimeForDisplay(selectedTime)}`;
                
                // Reset form and refresh
                resetForm();
                renderCalendar(currentDate);
            } else {
                alert('Error: ' + data.message);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        }
    });

    function resetForm() {
        document.getElementById('appointmentForm').reset();
        selectedDate = null;
        selectedTime = null;
        document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
        document.querySelector('.time-slots').innerHTML = '';
        
        // Reset doctor dropdown
        doctorSelect.innerHTML = '<option value="" disabled selected>Select a doctor</option>';
        fetchDoctors();
        
        setTimeout(() => {
            document.getElementById('confirmationMessage').style.display = 'none';
        }, 5000);
    }

    // Helper functions
    function getMonthName(monthIndex) {
        return ['January','February','March','April','May','June',
                'July','August','September','October','November','December'][monthIndex];
    }

    function formatDateForMySQL(date) {
        return date.toISOString().split('T')[0];
    }

    function formatTimeForDisplay(dbTime) {
        const [h, m] = dbTime.split(':');
        return `${h % 12 || 12}:${m} ${h >= 12 ? 'PM' : 'AM'}`;
    }

    function formatDateForDisplay(dateStr) {
        return new Date(dateStr).toLocaleDateString('en-US', { 
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
        });
    }
});
function isTimeSlotAvailable(dateStr, timeStr) {
    if (!bookedAppointments[dateStr]) return true;
    return !bookedAppointments[dateStr].includes(timeStr);
}
</script>
</body>
</html>
